---
title: FOC和SVPWM的作用
date: 2025-03-31
tags:
 - motor
 - FOC
 - SVPWM
categories:
 - Math
---

## 从零开始驱动BLDC

### 控制MOS管通断驱动直流电机

#### 直流有刷电机

电刷帮助电流换向使转子(线圈)一直按一个方向旋转，但电刷易磨损。

PWM控制有效电压从而控制转速，交换MOS上下管通断改变电流方向

PWM的占空比和频率

中心对齐PWM减少高频谐波能量

#### 直流无刷电机(BLDC)

？根据什么确定定子是三组线圈的呢？

考虑撤掉换向器，让线圈变为定子，人为控制电流方向改变磁场方向->六步换向

三相正弦波控制 相差120度 

三相电压和为定值 恒功率

#### 控制矢量合成

SPWM

大小与幅值

### FOC的动机

磁场定向控制（Field-Oriented Control，FOC）：使定子磁场垂直于转子磁场，此时转子有最大的转动力矩

定子电流可以解耦为励磁分量 id和转矩分量 iq

**按转子磁场定向**，即保持转子磁链旋转矢量始终与dq坐标系下的d轴重合，q轴正交，并将id设置为0。此时转子旋转力矩最大，电流全部能量用于转子旋转。力矩正比于id大小。

#### SVPWM

SPWM的最大压差与电源轨的比值

叠加锯齿波（1/2mid(u_a, u_b, u_c)）

### FOC控制

目标：获得三相电电压
限制条件：满足所需力矩

#### 克拉克变换

二维空间矢量至多两不相关矢量

三相电相位差180度，明显是有相关性的，想办法分解为不相关的两个分量

i_a,i_b,i_c -> i_alpha, i_beta(与定子固连)

三变量问题降维成两变量

#### 恒幅与恒功率克拉克变换

#### 帕克变换

i_alpha, i_beta -> i_d, i_q（与转子固连）

电角度theta：两坐标系的夹角，或者说i_alpha与i_d的夹角，可通过磁编码器获得

旋转矩阵

#### 结论

那控制流程就很显然了

i_q正比于力矩，所需力矩 -> i_q, 节省能量和简便操作i_d = 0;

i_q, i_d, theta -> i_alpha, i_beta -> i_a, i_b, i_c -> u_a, u_b, u_c -> PWM占空比

#### 开环

##### 速度环

转速到电压

#### PID闭环

##### 位置环

加磁编码器获取转子位置

##### 位置-速度环

加计数器获得转子转速

或者根据磁编码器的位置输出计算速度

##### 位置-速度-电流环

考虑到电感使电流滞后，按照预估力矩设置电压并不能使当前电流直接设置为预期电流

加电流传感器精确控制力矩



```C
// 代码实现思路
函数1：机械角度到电角度 机械角度*转子磁铁SN极数对
函数2：限制电角度为0-2pi 1.取模(负角度返回负值) 2.负角加2pi
函数3：将设定电压钳位在电源轨之内
函数4：设置相电压，输入参数u_q(力矩大小)，u_d(默认为0)，theta电角度
```



